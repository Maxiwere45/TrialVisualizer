Index: app.py
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+>import datetime\r\nimport import_csv as impcsv\r\nimport os\r\nimport auth\r\nimport db\r\nimport script_doi_extract as DOI_SEARCH\r\nfrom flask import Flask, render_template, jsonify, request\r\nfrom flask import request\r\nimport pandas as pd\r\n\r\n\r\ndef create_app(test_config=None):\r\n    # create and configure the app\r\n    app = Flask(__name__, instance_relative_config=True, template_folder='templates')\r\n    app.config.from_mapping(\r\n        SECRET_KEY='dev',\r\n        DATABASE=os.path.join(app.instance_path, 'app.sqlite'),\r\n    )\r\n    app.config['MONGO_URI'] = 'mongodb+srv://nrm4206a:9dfe351b@dbsae.ohuhcxc.mongodb.net/?retryWrites=true&w=majority'\r\n    app.config['MONGO_DBNAME'] = 'infos'\r\n\r\n    if test_config is None:\r\n        # load the instance config, if it exists, when not testing\r\n        app.config.from_pyfile('config.py', silent=True)\r\n    else:\r\n        # load the test config if passed in\r\n        app.config.from_mapping(test_config)\r\n\r\n    # ensure the instance folder exists\r\n    try:\r\n        os.makedirs(app.instance_path)\r\n    except OSError:\r\n        pass\r\n\r\n    # a simple page that says hello\r\n    @app.route('/')\r\n    def index():\r\n        heure_actuelle = datetime.datetime.now().time()\r\n        return render_template(\r\n            'home.html',\r\n            app=app,\r\n            tnow=heure_actuelle.strftime(\"%H:%M\")\r\n        )\r\n\r\n    @app.route('/clt')\r\n    def clinical_trial_page():\r\n        trials = db.get_trial()\r\n        women = db.get_total_esais_fem()\r\n        men = db.get_total_esais_male()\r\n        allg = db.get_total_essais()\r\n        return render_template(\r\n            'clinicaltrials.html',\r\n            app=app,\r\n            trials=trials,\r\n            women=women,\r\n            men=men,\r\n            allg=allg\r\n        )\r\n\r\n    @app.route('/doi-search')\r\n    def doi_search():\r\n        return render_template(\r\n            'doi-search.html',\r\n            app=app\r\n        )\r\n\r\n    @app.route('/import')\r\n    def import_page():\r\n        return render_template('import_data.html', app=app)\r\n\r\n    @app.route('/import-data', methods=['POST'])\r\n    def import_data():\r\n        # Récupérer le fichier CSV envoyé via le formulaire\r\n        file_csv = request.files['file']\r\n\r\n        # Recupérer le type sélectionné dans le formulaire\r\n        type_data = request.form['select-type']\r\n\r\n        # Vérifier que le fichier est bien un CSV\r\n        if not file_csv.filename.endswith('.csv'):\r\n            return 'Le fichier n\\'est pas un CSV !'\r\n\r\n        res = impcsv.traitement_CSV_IMPORT(type_data, file_csv.stream)\r\n        return res\r\n\r\n    @app.route('/pub')\r\n    def publications_page():\r\n        return render_template(\r\n            'publications.html',\r\n            app=app,\r\n            publications=db.get_publication(),\r\n            total_rand=db.get_total_pub_essais_obs(),\r\n            total_obs=db.get_total_pub_essais_rand(),\r\n            total_pub=db.get_total_pub()\r\n        )\r\n\r\n    # Request GET\r\n    @app.route('/chart-nb-phase')\r\n    def ma_liste():\r\n        return jsonify(db.get_phase_by_nb())\r\n\r\n    @app.route('/doi-get-data')\r\n    def doi_res():\r\n        # Récupérer les données de l'API CrossRef\r\n        param = str(request.args.get('q'))\r\n        result = DOI_SEARCH.get_doi(param)\r\n        return jsonify(result)\r\n\r\n    @app.route('/stats_pub')\r\n    def stats_pub():\r\n        return render_template('stat_publications.html', app=app)\r\n\r\n    @app.route('/stats_clt')\r\n    def stats_clt():\r\n        return render_template('stat_clinical_trial.html', app=app)\r\n\r\n    # Les fonctions doivent être déclarées avant ce bloc\r\n    db.init_app(app)\r\n    app.register_blueprint(auth.bp)\r\n    return app\r\n
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/app.py b/app.py
--- a/app.py	(revision 2594ee3fe1a7cc7c93522b4f354d57dc0a15c130)
+++ b/app.py	(date 1680120731073)
@@ -108,7 +108,14 @@
 
     @app.route('/stats_pub')
     def stats_pub():
-        return render_template('stat_publications.html', app=app)
+        toto_art = db.get_total_articles()
+        toto_preprint = db.get_total_preprints()
+        return render_template(
+            'stat_publications.html',
+            app=app,
+            toto_art=toto_art,
+            toto_preprint=toto_preprint
+        )
 
     @app.route('/stats_clt')
     def stats_clt():
Index: templates/stat_publications.html
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+><!DOCTYPE html>\r\n<html lang=\"en\">\r\n    <head>\r\n        <meta charset=\"utf-8\" />\r\n        <meta http-equiv=\"X-UA-Compatible\" content=\"IE=edge\" />\r\n        <meta name=\"viewport\" content=\"width=device-width, initial-scale=1, shrink-to-fit=no\" />\r\n        <meta name=\"description\" content=\"\" />\r\n        <meta name=\"author\" content=\"\" />\r\n        <title>Trial Visualizer</title>\r\n        <link rel=\"icon\" type=\"image/x-icon\" href=\"../others_ressources/icon_logo.png\">\r\n        <link href=\"https://cdn.jsdelivr.net/npm/simple-datatables@7.1.2/dist/style.min.css\" rel=\"stylesheet\" />\r\n        <script src=\"https://use.fontawesome.com/releases/v6.3.0/js/all.js\" crossorigin=\"anonymous\"></script>\r\n        <link href=\"../static/css/styles.css\" rel=\"stylesheet\" />\r\n    </head>\r\n    <body class=\"sb-nav-fixed\">\r\n        <nav class=\"sb-topnav navbar navbar-expand navbar-dark bg-dark\">\r\n            <!-- Navbar Brand-->\r\n            <a class=\"navbar-brand ps-3\" href=\"home.html\">Trial Visualizer</a>\r\n            <!-- Sidebar Toggle-->\r\n            <button class=\"btn btn-link btn-sm order-1 order-lg-0 me-4 me-lg-0\" id=\"sidebarToggle\" href=\"#!\"><i class=\"fas fa-bars\"></i></button>\r\n            <!-- Navbar Search-->\r\n            <form class=\"d-none d-md-inline-block form-inline ms-auto me-0 me-md-3 my-2 my-md-0\">\r\n                <div class=\"input-group\">\r\n                    <input class=\"form-control\" type=\"text\" placeholder=\"Search for...\" aria-label=\"Search for...\" aria-describedby=\"btnNavbarSearch\" />\r\n                    <button class=\"btn btn-primary\" id=\"btnNavbarSearch\" type=\"button\"><i class=\"fas fa-search\"></i></button>\r\n                </div>\r\n            </form>\r\n            <!-- Navbar-->\r\n            <ul class=\"navbar-nav ms-auto ms-md-0 me-3 me-lg-4\">\r\n                <li class=\"nav-item dropdown\">\r\n                    <a class=\"nav-link dropdown-toggle\" id=\"navbarDropdown\" href=\"#\" role=\"button\" data-bs-toggle=\"dropdown\" aria-expanded=\"false\"><i class=\"fas fa-user fa-fw\"></i></a>\r\n                    <ul class=\"dropdown-menu dropdown-menu-end\" aria-labelledby=\"navbarDropdown\">\r\n                        <li><a class=\"dropdown-item\" href=\"#\">Settings</a></li>\r\n                        <li><a class=\"dropdown-item\" href=\"#\">Activity Log</a></li>\r\n                        <li><hr class=\"dropdown-divider\" /></li>\r\n                        <li><a class=\"dropdown-item\" href=\"#\">Logout</a></li>\r\n                    </ul>\r\n                </li>\r\n            </ul>\r\n        </nav>\r\n        <div id=\"layoutSidenav\">\r\n            <div id=\"layoutSidenav_nav\">\r\n                <nav class=\"sb-sidenav accordion sb-sidenav-dark\" id=\"sidenavAccordion\">\r\n                    <div class=\"sb-sidenav-menu\">\r\n                        <div class=\"nav\">\r\n                            <div class=\"sb-sidenav-menu-heading\">Principale</div>\r\n                            <a class=\"nav-link\" href=\"{{ url_for('index') }}\">\r\n                                <div class=\"sb-nav-link-icon\"><i class=\"fa-solid fa-house\"></i></div>\r\n                                Tableau de bord\r\n                            </a>\r\n                            <a class=\"nav-link\" href=\"{{ url_for('clinical_trial_page') }}\">\r\n                                <div class=\"sb-nav-link-icon\"><i class=\"fa-solid fa-notes-medical\"></i></div>\r\n                                Essais cliniques\r\n                            </a>\r\n                            <a class=\"nav-link\" href=\"{{ url_for('publications_page') }}\">\r\n                                <div class=\"sb-nav-link-icon\"><i class=\"fa-solid fa-file\"></i></div>\r\n                                Publications\r\n                            </a>\r\n                            <a class=\"nav-link collapsed\" href=\"#\" data-bs-toggle=\"collapse\" data-bs-target=\"#collapseLayouts\" aria-expanded=\"false\" aria-controls=\"collapseLayouts\">\r\n                                <div class=\"sb-nav-link-icon\"><i class=\"fa-solid fa-chart-bar\"></i></div>\r\n                                Statistiques\r\n                                <div class=\"sb-sidenav-collapse-arrow\"><i class=\"fas fa-angle-down\"></i></div>\r\n                            </a>\r\n                            <div class=\"collapse\" id=\"collapseLayouts\" aria-labelledby=\"headingOne\" data-bs-parent=\"#sidenavAccordion\">\r\n                                <nav class=\"sb-sidenav-menu-nested nav\">\r\n                                    <a class=\"nav-link\" href=\"{{ url_for('stats_clt') }}\">Essais cliniques</a>\r\n                                    <a class=\"nav-link\" href=\"{{ url_for('stats_pub') }}\">Publications</a>\r\n                                </nav>\r\n                            </div>\r\n                            <a class=\"nav-link\" href=\"{{ url_for('doi_search') }}\">\r\n                                <div class=\"sb-nav-link-icon\"><i class=\"fa-solid fa-magnifying-glass-arrow-right\"></i></div>\r\n                                Recherche DOI\r\n                            </a>\r\n\r\n                            <div class=\"sb-sidenav-menu-heading\">Autre</div>\r\n                            <a class=\"nav-link\" href=\"{{ url_for('import_page') }}\">\r\n                                <div class=\"sb-nav-link-icon\"><i class=\"fa-solid fa-file-csv\"></i></div>\r\n                                Importer des données\r\n                            </a>\r\n                            <div class=\"sb-sidenav-menu-heading\">Addons</div>\r\n                            <a class=\"nav-link\" href=\"charts.html\">\r\n                                <div class=\"sb-nav-link-icon\"><i class=\"fas fa-chart-area\"></i></div>\r\n                                Graphiques\r\n                            </a>\r\n                            <a class=\"nav-link\" href=\"tables.html\">\r\n                                <div class=\"sb-nav-link-icon\"><i class=\"fas fa-table\"></i></div>\r\n                                Tableaux de données brutes\r\n                            </a>\r\n                        </div>\r\n                    </div>\r\n                    <div class=\"sb-sidenav-footer\">\r\n                        <div class=\"small\">Logged in as:</div>\r\n                        Amdjad Anrifou\r\n                    </div>\r\n                </nav>\r\n            </div>\r\n            <div id=\"layoutSidenav_content\">\r\n                <main>\r\n                    <div class=\"container-fluid px-4\">\r\n                        <h1 class=\"mt-4\">Statistiques des Publications</h1>\r\n                        <!--Séparateur-->\r\n                        <div class=\"separator-breadcrumb border-top\"></div>\r\n                        <br>\r\n                        <!--AFFICHAGES DES DONNEES ICI-->\r\n                        <!--Affichage du tableau-->\r\n                        <div class=\"card mb-4\">\r\n                            <div class=\"card-header\">\r\n                                <i class=\"fas fa-table me-1\"></i>\r\n                                Vue\r\n                            </div>\r\n                            <div class=\"card-body\">\r\n                                <table id=\"datatablesSimple\">\r\n                                    <thead>\r\n                                        <tr>\r\n                                            <th>Concept</th>\r\n                                            <th>Nb</th>\r\n                                        </tr>\r\n                                    </thead>\r\n                                     <tbody>\r\n                                        <!--CODE-->\r\n                                        //faire une fonction de la fonction get_top_concepts_by_publication_count\r\n                                        {% for document in publications %}\r\n                                            <tr>\r\n                                                <td>{{ document[''] }}</td>\r\n                                                <td>{{ document[''] }}</td>\r\n\r\n                                            </tr>\r\n                                        {% endfor %}\r\n                                        {% block content %}{% endblock %}\r\n                                        <!--CODE-->\r\n                                        <tr>\r\n                                            <th></th>\r\n                                            <th></th>\r\n                                        </tr>\r\n                                    </tbody>\r\n                                </table>\r\n                        <!--Afficher un graphe pie chart-->\r\n\r\n\r\n                </main>\r\n                <footer class=\"py-4 bg-light mt-auto\">\r\n                    <div class=\"container-fluid px-4\">\r\n                        <div class=\"d-flex align-items-center justify-content-between small\">\r\n                            <div class=\"text-muted\">Copyright &copy; Trial Visualizer 2023</div>\r\n                            <div>\r\n                                <a href=\"#\">Privacy Policy</a>\r\n                                &middot;\r\n                                <a href=\"#\">Terms &amp; Conditions</a>\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n                </footer>\r\n            </div>\r\n        </div>\r\n        <script src=\"https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js\" crossorigin=\"anonymous\"></script>\r\n        <script src=\"../static/js/scripts.js\"></script>\r\n        <script src=\"https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.8.0/Chart.min.js\" crossorigin=\"anonymous\"></script>\r\n        <script src=\"../static/js/assets/demo/chart-bar-demo.js\"></script>\r\n        <script src=\"../static/js/scripts.js\"></script>\r\n        <script src=\"https://cdn.jsdelivr.net/npm/simple-datatables@7.1.2/dist/umd/simple-datatables.min.js\" crossorigin=\"anonymous\"></script>\r\n        <script src=\"../static/js/datatables-simple-demo.js\"></script>\r\n    </body>\r\n</html>\r\n
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/templates/stat_publications.html b/templates/stat_publications.html
--- a/templates/stat_publications.html	(revision 2594ee3fe1a7cc7c93522b4f354d57dc0a15c130)
+++ b/templates/stat_publications.html	(date 1680121343666)
@@ -100,6 +100,28 @@
                         <h1 class="mt-4">Statistiques des Publications</h1>
                         <!--Séparateur-->
                         <div class="separator-breadcrumb border-top"></div>
+                        <br>
+                            <div class="container">
+                                <div class="row">
+                                    <div class="col-md-4">
+                                        <div class="card">
+                                            <div class="card-header">Total des articles</div>
+                                             <div class="card-body">
+                                                <h5 class="card-title">{{toto_art }}</h5>
+                                             </div>
+                                        </div>
+                                    </div>
+                                    <div class="col-md-4">
+                                        <div class="card">
+                                            <div class="card-header">Total des preprints</div>
+                                                <div class="card-body">
+                                                    <h5 class="card-title">{{ toto_preprint}}</h5>
+                                            </div>
+                                        </div>
+                                    </div>
+                                </div>
+                            </div>
+
                         <br>
                         <!--AFFICHAGES DES DONNEES ICI-->
                         <!--Affichage du tableau-->
@@ -117,12 +139,12 @@
                                         </tr>
                                     </thead>
                                      <tbody>
-                                        <!--CODE-->
-                                        //faire une fonction de la fonction get_top_concepts_by_publication_count
-                                        {% for document in publications %}
+                                        <!--CODE
+                                        faire une fonction de la fonction get_top_concepts_by_publication_count -->
+                                        {% for concepts, count in get_top_concepts_by_publication_count.items()%}
                                             <tr>
-                                                <td>{{ document[''] }}</td>
-                                                <td>{{ document[''] }}</td>
+                                                <td>{{ concepts}}</td>
+                                                <td>{{ count}}</td>
 
                                             </tr>
                                         {% endfor %}
